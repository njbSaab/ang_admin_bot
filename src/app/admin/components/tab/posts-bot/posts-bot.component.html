<section class="posts-bot w-full">
  <!-- –ó–∞–≥–æ–ª–æ–≤–æ–∫ -->
  <div
    class="bg-main-trans2-gradient-90 header-tab flex items-center justify-between px-[20px] py-[10px] my-[30px] rounded-[20px] w-[70%] mx-auto"
  >
    <h2 class="title-tab text-xl text-main-trans font-bold">–ü–æ—Å—Ç—ã –±–æ—Ç–∞</h2>
    <p
      class="text-right flex gap-2 items-center rounded-[20px] bg-main px-[15px] py-[5px]"
    >
      –í—Å–µ–≥–æ –ø–æ—Å—Ç–æ–≤:
      <span class="font-bold text-2xl">{{ posts.length }}</span>
    </p>
  </div>

  <!-- –°–æ–æ–±—â–µ–Ω–∏—è –æ–± —É—Å–ø–µ—Ö–µ –∏ –æ—à–∏–±–∫–∞—Ö -->
  <div
    *ngIf="successMessage"
    class="alert alert-success relative flex justify-between mb-4"
  >
    <b>{{ successMessage }}</b>
    <span class="close" (click)="closeMessages()">‚úñ</span>
  </div>

  <div *ngIf="errorMessage" class="alert alert-error relative mb-4">
    {{ errorMessage }}
    <span class="close" (click)="closeMessages()">‚úñ</span>
  </div>

  <!-- –°–ø–∏—Å–æ–∫ –ø–æ—Å—Ç–æ–≤ -->
  <div *ngIf="posts.length > 0; else loading">
    <div
      *ngFor="let post of posts; index as i"
      class="card-wrapper bg-main-trans-gradient-0 rounded-[20px] p-[20px]"
    >
      <div class="flex items-start justify-between mb-[20px]">
        <p class="text-lg font-bold text-indigo-600">üìù –ü–æ—Å—Ç ‚Ññ{{ i + 1 }}</p>
        <div class="card-date flex items-center gap-2">
          <p class="text-xs text-gray-500">
            –î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è: {{ post.created_at | date: "medium" }}
          </p>
        </div>
      </div>

      <!-- –ö–∞—Ä—Ç–æ—á–∫–∞ –ø–æ—Å—Ç–∞ -->
      <div class="card bg-base-100 mx-auto w-[80%] shadow-xl">
        <div *ngIf="!post.isEditing; else editMode">
          <figure *ngIf="post.post_image_url">
            <img [src]="post.post_image_url" alt="Post Image" />
          </figure>
          <div class="card-body">
            <p class="text-indigo-600">ID: {{ post.id }}</p>
            <h3 class="text-xl text-indigo-400 font-bold">
              {{ post.post_title }}
            </h3>
            <p>{{ post.post_content }}</p>
            <div class="card-actions justify-center pt-[20px]">
              <button class="btn btn-ghost pr-0" (click)="toggleEdit(post)">
                –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å
                <span class="btn btn-primary">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="30"
                    height="30"
                    viewBox="0 0 24 24"
                  >
                    <g
                      fill="none"
                      stroke="#fff"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2"
                    >
                      <path
                        stroke-dasharray="56"
                        stroke-dashoffset="56"
                        d="M3 21l2 -6l11 -11c1 -1 3 -1 4 0c1 1 1 3 0 4l-11 11l-6 2"
                      >
                        <animate
                          fill="freeze"
                          attributeName="stroke-dashoffset"
                          dur="0.6s"
                          values="56;0"
                        />
                      </path>
                      <path
                        stroke-dasharray="8"
                        stroke-dashoffset="8"
                        d="M15 5l4 4"
                      >
                        <animate
                          fill="freeze"
                          attributeName="stroke-dashoffset"
                          begin="0.6s"
                          dur="0.2s"
                          values="8;0"
                        />
                      </path>
                    </g>
                  </svg>
                </span>
              </button>
            </div>
          </div>
        </div>

        <!-- –†–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è -->
        <ng-template #editMode>
          <div class="p-4">
            <label class="block text-sm text-indigo-400 font-bold"
              >–ù–∞–∑–≤–∞–Ω–∏–µ –ø–æ—Å—Ç–∞:</label
            >
            <input
              [(ngModel)]="post.post_title"
              class="input w-full mt-2 mb-4 border border-gray-300 rounded-lg px-4 py-2.5 focus:ring focus:ring-blue-300 focus:ring-opacity-40"
              placeholder="–í–≤–µ–¥–∏—Ç–µ –∑–∞–≥–æ–ª–æ–≤–æ–∫"
            />

            <label class="block text-sm text-indigo-400 font-bold"
              >–ö–æ–Ω—Ç–µ–Ω—Ç –ø–æ—Å—Ç–∞:</label
            >
            <textarea
              [(ngModel)]="post.post_content"
              class="w-full h-40 border rounded-lg px-4 py-2 focus:ring focus:ring-blue-300 focus:ring-opacity-40"
              placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–æ–Ω—Ç–µ–Ω—Ç –ø–æ—Å—Ç–∞"
            ></textarea>

            <label class="block text-sm text-indigo-400 font-bold mt-4"
              >URL –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è:</label
            >
            <input
              [(ngModel)]="post.post_image_url"
              (blur)="refreshImage(post)"
              class="input w-full mt-2 mb-4 border border-gray-300 rounded-lg px-4 py-2.5 focus:ring focus:ring-blue-300 focus:ring-opacity-40"
              placeholder="https://example.com/image.jpg"
            />

            <figure *ngIf="post.post_image_url" class="mt-4">
              <img [src]="post.post_image_url" alt="Post Image" />
            </figure>

            <div class="card-actions justify-center pt-4">
              <button class="btn pr-0 text-success" (click)="saveChanges(post)">
                –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                <span class="btn btn-accent">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="30"
                    height="30"
                    viewBox="0 0 24 24"
                  >
                    <path
                      fill="none"
                      stroke="#fff"
                      stroke-dasharray="24"
                      stroke-dashoffset="24"
                      stroke-linecap="round"
                      stroke-linejoin="round"
                      stroke-width="2.7"
                      d="M5 11l6 6l10 -10"
                    >
                      <animate
                        fill="freeze"
                        attributeName="stroke-dashoffset"
                        dur="0.96s"
                        values="24;0"
                      />
                    </path>
                  </svg>
                </span>
              </button>
            </div>
          </div>
        </ng-template>
      </div>
    </div>
  </div>

  <!-- –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö -->
  <ng-template #loading>
    <div class="text-center">
      <p>–ó–∞–≥—Ä—É–∑–∫–∞ –ø–æ—Å—Ç–æ–≤...</p>
    </div>
  </ng-template>
</section>
